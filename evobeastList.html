<!DOCTYPE HTML>
<html>
	<head>
<style type='text/css'>
	body {
		background-color: #333;
	}
	td, th {
		background-color: #FFF;
	}
	.tableBreak {
		background-color: #000;
	}
	ul.evobeastList {
		width: 100%;
		list-style-type: none;
		margin: 5%;
		padding: 0;
		position: relative;
		user-select: none;
	}
	ul.evobeastList li {
		display: inline-block;
		margin: 1%;
	}
	#move {
		pointer-events: none;
                position: fixed;
		user-select: none;
		list-style-type: none;
		margin: 0;
		padding: 0;
            }
</style>
	</head>
	<body>
		<ul id='evobeastList' class='evobeastList'>
		</ul>
		<ul id='move'>
		</ul>
	<script>
		var x, y, xShift, yShift;
		window.onload = function() {
			var mydiv = document.getElementById('move');
			window.addEventListener('mousemove', function(event) {
				x = event.clientX;
				y = event.clientY;
				if (typeof x !== 'undefined') {
					mydiv.style.left = x + xShift + 'px';
					mydiv.style.top = y + yShift + 'px';
				}
			}, false);
			addListItem({name: 'renla'});
			addListItem({name: 'vespra'});
			addListItem({name: 'arost'});
			addListItem({name: 'gribble'});
			addListItem({name: 'aurum'});
			addListItem({name: 'ampush'});
		};
		function createListItem(data, moveable) {
			var list = document.getElementById('evobeastList');
			var li = document.createElement('li');
			var img = new Image();
			var canvas = document.createElement('canvas');
			canvas.width = 64;
			canvas.height = 64;
			canvas.style.padding = 0;
			canvas.style.margin= 0;
			var ctx = canvas.getContext('2d');
			var html = `<table style="border-spacing:0; border:1px solid black;">
					<tr>
						<th bgcolor="#000" rowspan="3"></th>
						<td class="tableBreak" width="2" rowspan="3"></td>
						<td colspan="1"><td>
						<td class="tableBreak" width="2" rowspan="3"></td>
						<td>L</td>
						<td>99</td>
					</tr>
					<tr>
						<td class="tableBreak" height="2" colspan="6"></td>
					</tr>
					<tr>
						<td>HP</td>
						<td>9999</td>
						<td>MP</td>
						<td>99</td>
					</tr>
					<tr>
					</tr>
				</table>`;
			li.innerHTML = html;
			var cell = li.getElementsByTagName('th');
			cell[0].appendChild(canvas);
			img.src = 'images/evobeasts/spr_'+data.name+'_large.png';
			spr = sprite({
				width: 64,
				height: 64,
				stretch: 1,
				image: img,
				context: ctx,
			});
			spr.render();
			if (moveable) {
				li.onmouseup = function(){insertList(li.id);};
				li.onmousedown = function(){grabListItem(li.id);};
			}
			li.data = data;
			return li;
		}
		function addListItem(data) {
			var list = document.getElementById('evobeastList');
			var li = createListItem(data, true);
			list.appendChild(li);
			setListIds();
		}
		function sprite(options) {
			var that = {},
			frameIndex = 0,
			tickCount = 0,
			ticksPerFrame = options.ticksPerFrame || 0,
			numberOfFrames = options.numberOfFrames || 1;

			that.context = options.context;
			that.width = options.width;
			that.height = options.height;
			that.image = options.image;
			that.loop = options.loop || true;
			that.stretch = options.stretch || 1;

			that.update = function() {
				tickCount += 1;
				if (tickCount > ticksPerFrame) {
					tickCount = 0;
					if (frameIndex < numberOfFrames - 1) {
						frameIndex += 1;
					} else if (that.loop){
						frameIndex = 0;
					}
				}
			}
			that.image.onload = function() {
				that.render();
			}
			that.render = function() {
				that.context.clearRect(0, 0, that.width, that.height);
				that.context.drawImage(
					that.image,
					frameIndex * that.width / numberOfFrames,
					0,
					that.width / numberOfFrames,
					that.height,
					0,
					0,
					that.width / numberOfFrames * that.stretch,
					that.height * that.stretch,
				);
			}
			return that;
		}
		function setListIds() {
			var list = document.getElementById('evobeastList');
			var lis = list.getElementsByTagName('li');
			for (var  i = 0; i < lis.length; ++i) {
				var li = lis[i];
				li.id = ''+i;
			}
		}
		function insertList(myId) {
			var item = document.getElementById(myId);
			var list = item.parentElement;
			var moveItem = document.getElementById('move').children[0];
			var data = moveItem.data;
			document.getElementById('move').removeChild(moveItem);
			var li = createListItem(data, true);	
			list.insertBefore(li, item);
			setListIds();
		}
		function returnListItem() {
			var move = document.getElementById('move').children[0];
			var returnItem = moveDiv.cloneNode('true');
			var myId = move.id;
		}
		function grabListItem(myId) {
			if (document.getElementById('move').getElementsByTagName('li').length == 0) {
				var moveDiv = document.getElementById('move');
				var item = document.getElementById(myId);
				var moveItem = createListItem(item.data, false); 
				var rect = item.getBoundingClientRect();
				xShift = rect.left - event.clientX;
				yShift = rect.top - event.clientY;
				moveDiv.appendChild(moveItem);
				item.parentElement.removeChild(item);
			}
		}
	</script>
	</body>
</html>
