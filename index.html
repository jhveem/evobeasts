<html>
<head>
	<script src='sprites.js'></script>
	<script src='scripts/evobeastData.js'></script>
	<script src='scripts/skillData.js'></script>
	<style>
	canvas {
		image-rendering: pixelated;
	}
	</style>
</head>
<body>
<h1>Welcome to Evobeasts</h1>
<canvas id='ctx' style='border:1px solid #000000;'></canvas>
<button onclick='attack()'>Click</button>
<script>
	var battlePause = false;
	function attack() {
		if (battlePause == false) {
			battlePause = true;
			var source = battleInst[commands[0].source];
			var targList = commands[0].targ;
			var skill = commands[0].skill;
			var targ = source;
			if (targList.length == 1) {
				targ = battleInst[targList[0]];
			}
			source.state='attack';
			source.img.frameCurrent = 0;
			source.img.imageSpeed = source.img.sheetData[battleInst.allyTamer.state].speed;
			if (targ.team != source.team) {
				source.xx = targ.base_x;
				if (source.team == 1) {
					source.yy = targ.base_y + 8;
				} else {
					source.yy = targ.base_y - 48;
				}
			} else {
				source.yy = source.base_y - 8;
			}
			commands.splice(0, 1);
		}
	}
	
	var commands = new Array();

	commands.push({
		source: 'allyTamer',
		targ: ['enemyEvobeast1'],
		skill: 'attack',
	});
	commands.push({
		source: 'allyEvobeast1',
		targ: ['enemyEvobeast2'],
		skill: 'attack',
	});
	commands.push({
		source: 'enemyEvobeast2',
		targ: ['allyEvobeast2'],
		skill: 'attack',
	});
	commands.push({	
		source: 'allyEvobeast2',
		targ: ['allyEvobeast2'],
		skill: 'attack',
	});
	var ctx = document.getElementById('ctx').getContext('2d');
	var canvas = document.getElementById('ctx');
	var renla = {};
	var WIDTH = 960;
	var HEIGHT = 640;
	var STRETCH = 4;
	var evobeastSprites = {};
	var skillSprites = {};
	var animations = [];
	canvas.width = WIDTH;
	canvas.height = HEIGHT;
	ctx.imageSmoothingEnabled = false;
	for (var e in evobeastData) {
		evobeastSprites[e] = {};
		createImage(evobeastSprites[e], 'evobeasts/'+e, evobeastSheetData);
	}
	for (var s in skillData) {
		skillSprites[s] = {};
		createImage(skillSprites[s], 'animations/'+s);
	}
	var battleBack = {};
	createBattleBack(battleBack, 'grass');
	
	ctx.font = '30px Arial';
	setInterval(update, 60);
	function update() {
		ctx.clearRect(0, 0, WIDTH, HEIGHT);
		drawBattleBack(ctx, battleBack);
		for (var c in battleInst) {
			var inst = battleInst[c];
			if (inst.img.hasOwnProperty('img')) {
				drawEvobeast(ctx, inst);
			}
		}
		for (var a in animations) {
			drawAnimation(ctx, animations[a]);
			if (animations[a].frameCurrent == -1) {
				animations.splice(a, 1);
			}
		}
	}
	var battleInst = {
		allyTamer:{img:{},xx:104,yy:104,dir:'up',team:1},
		allyEvobeast1:{img:{},xx:48,yy:104,dir:'up',team:1},
		allyEvobeast2:{img:{},xx:160,yy:104,dir:'up',team:1},
		enemyTamer:{img:{},xx:104,yy:32,dir:'down',team:2},
		enemyEvobeast1:{img:{},xx:48,yy:32,dir:'down',team:2},
		enemyEvobeast2:{img:{},xx:160,yy:32,dir:'down',team:2},
	};
	for (var i in battleInst) {
		var inst = battleInst[i];
		inst.base_x = inst.xx;
		inst.base_y = inst.yy;
		inst.state = 'idle';
		inst.frameCurrent = 0;
	}	
	battleInst.allyTamer.img = evobeastSprites.will_sword;
	battleInst.allyEvobeast1.img = evobeastSprites.renla;
	battleInst.allyEvobeast2.img = evobeastSprites.vespra;
	battleInst.enemyEvobeast1.img = evobeastSprites.vespra;
	battleInst.enemyEvobeast2.img = evobeastSprites.renla;
</script>
</body>
</html>
